<div class="topbar-item">
  <div ngbDropdown>
    <button
      class="topbar-link dropdown-toggle drop-arrow-none"
      ngbDropdownToggle
      type="button"
    >
      <ng-icon name="lucideBell" class="fs-xxl" />
      @if (getCantidadNoLeidas() > 0) {
        <span class="badge badge-square text-bg-success topbar-badge"
          >{{ getCantidadNoLeidas() }}</span
        >
      }
    </button>

    <div class="dropdown-menu dropdown-menu-end notification-dropdown shadow-lg border-0" ngbDropdownMenu>
      <!-- Header -->
      <div class="notification-header d-flex justify-content-between align-items-center px-4 py-3 bg-white">
        <h2 class="fw-bold text-dark mb-0" style="font-size: 22px; letter-spacing: -0.02em;">Notifications</h2>
        <div class="d-flex align-items-center gap-3">
          <button 
            (click)="markAllAsRead()" 
            class="btn btn-link btn-sm text-muted text-decoration-none p-0 border-0"
            style="font-size: 12px; font-weight: 500;"
          >
            Mark all as read
          </button>
          <button 
            (click)="loadNotifications()" 
            class="btn btn-link text-muted p-0 border-0"
            style="transition: color 0.2s ease;"
          >
            <ng-icon name="lucideSettings" style="width: 20px; height: 20px;" />
          </button>
        </div>
      </div>

      <!-- Notification List -->
      <ngx-simplebar style="max-height: 450px;">
        @if (notifications && notifications.length > 0) {
          @for (notification of notifications; track notification.id) {
            <article 
              class="notification-item d-flex align-items-start gap-3 px-4 py-4 cursor-pointer"
              [class.notification-unread]="!notification.leida"
              [class.notification-read]="notification.leida"
              (click)="toggleLida(notification); $event.stopPropagation()"
            >
              <!-- Icon -->
              @if (notification.asunto) {
                <div class="notification-icon flex-shrink-0 rounded-circle d-flex align-items-center justify-center"
                     [class.icon-unread]="!notification.leida"
                     [class.icon-read]="notification.leida"
                >
                  <ng-icon [name]="getIconNameAccion(notification.asunto)" style="width: 24px; height: 24px;" />
                </div>
              }

              <!-- Content -->
              <div class="flex-grow-1" style="min-width: 0;">
                <p class="notification-text mb-1" [innerHTML]="notification.mensaje"></p>
                <span class="notification-time d-block" style="font-size: 12px; color: #6b7280; font-weight: 500;">
                  {{ getTimeAgo(notification.fecha) }}
                </span>
              </div>

              <!-- Checkmark -->
              <div class="flex-shrink-0 mt-1">
                <ng-icon 
                  name="lucideCheck" 
                  class="notification-check"
                  [class.text-success]="notification.leida"
                  style="width: 20px; height: 20px;"
                />
              </div>
            </article>
          }
        } @else {
          <div class="text-center py-5 text-muted">
            <ng-icon name="lucideBellOff" class="mb-2" style="width: 48px; height: 48px; opacity: 0.3;" />
            <p class="mb-0">No tienes notificaciones</p>
          </div>
        }
      </ngx-simplebar>
    </div>
  </div>
</div>

<div class="explorer">

    <!-- CONTROLES -->
    <div class="controls">
        <p-select [options]="tipos" optionLabel="label" optionValue="value" [(ngModel)]="selectedTipo"
            (ngModelChange)="cargarRoot()"></p-select>

        <p-select [options]="ordenOptions" optionLabel="label" optionValue="value" [(ngModel)]="ordenSeleccionado"
            (ngModelChange)="cargarRoot()"></p-select>

        <p-select [options]="directionOptions" optionLabel="label" optionValue="value" [(ngModel)]="ordenDirection"
            (ngModelChange)="cargarRoot()"></p-select>

        <button pButton label="Recargar" icon="pi pi-refresh" (click)="cargarRoot()"></button>
    </div>

        <!-- TREE -->
        <div class="tree-wrapper" style="position: relative">
                        @if (loadingRoot()) {
                            <app-loading-spinner class="root-spinner"></app-loading-spinner>
                        }
            <p-tree [value]="nodes()" (onNodeExpand)="onNodeExpand($event)">
        <!-- <ng-template pTemplate="default" let-node>
            <div class="node" [pTooltip]="getTooltip(node)" tooltipPosition="right" (click)="onNodeSelect(node)">
                <span>{{ node.label }}</span>

                <span *ngIf="isNew(node.data.updatedAt)" class="new">NEW</span>

                <span *ngIf="node.data.size" class="size">• {{ formatSize(node.data.size) }}</span>
            </div>
        </ng-template> -->
        <ng-template pTemplate="default" let-node>
            <div class="node" [pTooltip]="getTooltip(node)" tooltipPosition="right">

                <span class="label" (click)="onNodeSelect(node)">{{ node.label }}</span>
                                @if (isLoading(node)) {
                                    <app-loading-spinner class="inline-spinner"></app-loading-spinner>
                                }

                                @if (isNew(node.data.updatedAt)) {
                                    <span class="new">NEW</span>
                                }
                                @if (node.data.size) {
                                    <span class="size">• {{ formatSize(node.data.size) }}</span>
                                }

                <!-- BOTÓN DESCARGAR -->
                <button pButton
                icon="pi pi-download"
                class="p-button-sm p-button-text download-btn"
                (click)="onDescargar(node); $event.stopPropagation()">
                </button>
            </div>
        </ng-template>
            </p-tree>
        </div>

    <!-- PREVIEW DIALOG -->
    <p-dialog [visible]="previewVisible()" (visibleChange)="previewVisible.set($event)" [modal]="true"
        [style]="{ width: '70vw' }" [header]="previewTitle()">
        <!-- IMAGEN -->
                @if (previewType() === 'image') {
                    <img [src]="previewContent()" style="width: 100%; border-radius: 8px;" />
                }

        <!-- PDF -->
                @if (previewType() === 'pdf') {
                    <iframe [src]="previewContent()" style="width: 100%; height: 75vh; border: none;"></iframe>
                }

        <!-- JSON -->
                @if (previewType() === 'json') {
                    <pre style="max-height: 70vh; overflow: auto;">
{{ previewContent() | json }}
    </pre>
                }

        <!-- TEXTO -->
                @if (previewType() === 'text') {
                    <pre style="max-height: 70vh; overflow: auto;">
{{ previewContent() }}
    </pre>
                }

    </p-dialog>
</div>